package main

import (
	"bytes"
	"flag"
	"fmt"
	"log"
	"os"
	"os/signal"
	"syscall"

	"github.com/auyer/commanderBot/config"

	"github.com/auyer/commanderBot/bot"
)

const (
	version = "0.2-beta"
	website = "github.com/auyer/commanderbot/"
	banner  = "\n\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x7c\x5f\x5f\x5f\x20\x20\x5f\x20\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x5f\x20\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x20\x5f\x5f\x20\x5f\x20\x5f\x20\x5f\x5f\x20\x20\x20\x5f\x5f\x7c\x20\x7c\x20\x5f\x5f\x5f\x20\x5f\x20\x5f\x5f\x7c\x20\x5f\x5f\x20\x29\x20\x20\x5f\x5f\x5f\x20\x7c\x20\x7c\x5f\x20\x0a\x20\x7c\x20\x7c\x20\x20\x20\x2f\x20\x5f\x20\x5c\x7c\x20\x27\x5f\x20\x60\x20\x5f\x20\x5c\x7c\x20\x27\x5f\x20\x60\x20\x5f\x20\x5c\x20\x2f\x20\x5f\x60\x20\x7c\x20\x27\x5f\x20\x5c\x20\x2f\x20\x5f\x60\x20\x7c\x2f\x20\x5f\x20\x5c\x20\x27\x5f\x5f\x7c\x20\x20\x5f\x20\x5c\x20\x2f\x20\x5f\x20\x5c\x7c\x20\x5f\x5f\x7c\x0a\x20\x7c\x20\x7c\x5f\x5f\x7c\x20\x28\x5f\x29\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x28\x5f\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x7c\x20\x28\x5f\x7c\x20\x7c\x20\x20\x5f\x5f\x2f\x20\x7c\x20\x20\x7c\x20\x7c\x5f\x29\x20\x7c\x20\x28\x5f\x29\x20\x7c\x20\x7c\x5f\x20\x0a\x20\x20\x5c\x5f\x5f\x5f\x5f\x5c\x5f\x5f\x5f\x2f\x7c\x5f\x7c\x20\x7c\x5f\x7c\x20\x7c\x5f\x7c\x5f\x7c\x20\x7c\x5f\x7c\x20\x7c\x5f\x7c\x5c\x5f\x5f\x2c\x5f\x7c\x5f\x7c\x20\x7c\x5f\x7c\x5c\x5f\x5f\x2c\x5f\x7c\x5c\x5f\x5f\x5f\x7c\x5f\x7c\x20\x20\x7c\x5f\x5f\x5f\x5f\x2f\x20\x5c\x5f\x5f\x5f\x2f\x20\x5c\x5f\x5f\x7c\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x0a\nCommander Multi Bot, a Discord Bot written in GO\n%s\n%s\n_________________________________________________________________\n\n"
	// logo built with http://www.patorjk.com/software and https://www.browserling.com/tools/utf8-encode
)

func main() {
	log.Printf(banner, green("v"+version), cyan(website))
	configFile := flag.String("config", "./config.json", "Configuration File Location")
	flag.Parse()

	config, err := config.ReadConfig(*configFile)
	if err != nil {
		log.Print(err.Error())
		return
	}

	bot.Start(config.CommanderToken, config.ServantTokens, config.BotPrefix)
	defer bot.Close()
	quit := make(chan os.Signal)
	signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM, os.Interrupt)
	<-quit

}

// TEXT COLOUR FUNCTIONS
type (
	inner func(interface{}) string
)

var (
	green = outer("32")
	cyan  = outer("36")
)

func outer(n string) inner {
	return func(msg interface{}) string {
		b := new(bytes.Buffer)
		b.WriteString("\x1b[")
		b.WriteString(n)
		b.WriteString("m")
		return fmt.Sprintf("%s%v\x1b[0m", b.String(), msg)
	}
}
